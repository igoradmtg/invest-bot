# Торговый бот на основе Tinkoff Invest Python gRPC client API

## Статус проекта

Статус проекта — это пример торгового бота, и он не готов к использованию в производственной среде.  
Предоставленная стратегия торговли — это всего лишь пример и в итоге приносит отрицательную прибыль.

## Описание

Здесь представлен торговый бот для биржи MOEX с возможностью отправки информации о торговле в чат Telegram.  
Бот использует [Tinkoff Invest Python gRPC client](https://github.com/Tinkoff/invest-python) API.

## Возможности

- Торговля акциями в RUB через [Тинькофф Инвестиции](https://www.tinkoff.ru/invest/) на бирже MOEX  
- Возможность использования персональной торговой стратегии для каждой акции  
- Информация о торговле отправляется в чат Telegram (детали ордеров, сводка торгового дня и т.д.)  

Примечание: представленная в коде стратегия торговли — это всего лишь пример и не является рекомендацией для торговли или инвестиций.

## Перед запуском

### Зависимости

- [Tinkoff Invest Python gRPC client](https://github.com/Tinkoff/invest-python)  
<!-- termynal -->
```
$ pip install tinkoff-investments
```
- [aiogram](https://docs.aiogram.dev/en/latest/)  
<!-- termynal -->
```
$ pip install -U aiogram
```

### Брокерский счет

Откройте брокерский счет в [Тинькофф Инвестиции](https://www.tinkoff.ru/invest/) и пополните его:  
1. Должна быть включена опция "Margin trading".  
Не забудьте получить TOKEN для API торговли.

### Telegram (опционально)

Зарегистрируйте бота через @BotFather.  
Создайте чат и получите chat_id.  
P.S. Пожалуйста, используйте Google для поиска подробной инструкции по получению chat_id.

### Необходимая конфигурация (минимальная)

1. Откройте файл `settings.ini`.  
2. Укажите токен для торгового API в `TOKEN` (секция `INVEST_API`).  
3. (Опционально) Укажите токен для бота Telegram в `TELEGRAM_BOT_TOKEN` (секция `BLOG`).  
4. (Опционально) Укажите ID чата Telegram в `TELEGRAM_CHAT_ID` (секция `BLOG`).

### Запуск

Рекомендуется использовать Python 3.10 (бот тестировался на версии 3.10, включая реальную торговлю).  
Запустите main.py.

## Конфигурация

Конфигурацию можно указать в файле settings.ini.

### Секция INVEST_API

Токен и имя приложения для API [Тинькофф Инвестиции](https://www.tinkoff.ru/invest/).

### Секция BLOG

- status — режим работы Telegram:  
  - 0 — отключен  
  - 1 — включен  
- token и chat id для API Telegram.

### Секция TRADING_ACCOUNT

Минимальная сумма в RUB на счете для начала торговли.

### Секция TRADING_SETTINGS

Настройки для управления временем. Бот торгует только в основной торговой сессии. Бот игнорирует пре- и пост-маркет и т.д.

### Секция Strategies

Настройки для торговых стратегий.  
Секция STRATEGY_ticker_name:  
- `STRATEGY_NAME` — имя алгоритма  
- `TICKER` — имя тикера (удобное для чтения имя для сообщений в Telegram)  
- `FIGI` — FIGI акции. Обязательно для API  
- `MAX_LOTS_PER_ORDER` — Максимальное количество лотов на ордер  

Секция STRATEGY_ticker_name_SETTINGS:  
Детальные настройки для стратегии. Класс стратегии читает и парсит настройки вручную.  
Примечание: Только одна стратегия на одну акцию в конфигурации.

## Торговля на фондовой бирже

Перед запуском:  
- Проверка токена  
- Подходящий счет выбирается автоматически по токену  
- По расписанию торговли бот выбирает время для начала торговли (начало основной торговой сессии)  

Основная сессия:  
- Бот проверяет:  
  - Статус акции для каждой акции (список стратегий из конфигурации)  
  - Минимальную сумму в RUB на счете  
- Запускает gRPC stream для данных из API  
- Стратегии анализируют свечи и возвращают сигналы при необходимости  
- Бот открывает ордера по сигналам от стратегий  
- Если уровни stop или take profit подтверждаются, бот закрывает ордера  

Расписание торговли:  
- Бот ожидает начала и конца основной торговой сессии  
- Бот работает каждый торговый день  
- Перезапуск не требуется для торговли. Только в чрезвычайных ситуациях.

## Как добавить новую стратегию

- Напишите новый класс с логикой торговли  
- Новый класс должен наследовать от IStrategy  
- Присвойте имя новому классу  
- Расширьте класс StrategyFactory именем и возвратом нового класса по имени  
- Укажите новые настройки в файле settings.ini. Укажите имя нового класса в `STRATEGY_NAME`  
- Протестируйте новый класс на исторических свечах  

## Сообщения в Telegram

Информация о:  
- Сводке торгового дня в начале и списке акций  
- Открытии и закрытии ордеров, уровнях take profit и stop loss  
- Сводке торгового дня в конце дня  

Сообщения в Telegram опциональны и могут быть отключены без влияния на торговлю.

## Логирование

Все логи записываются в logs/robot.log.  
Любые настройки можно изменить в коде main.py.

## Журнал изменений проекта

[Здесь](CHANGELOG.md)

## Отказ от ответственности

Автор не несет ответственности за любые ошибки или упущения, а также за результаты торговли, полученные от использования этого бота.
